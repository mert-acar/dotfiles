---
- name: Ensure tmux is installed
  ansible.builtin.command: which tmux
  register: tmux_check
  changed_when: false
  failed_when: false

- name: Create tmux config directory
  ansible.builtin.file:
    path: "{{ dotfiles_home }}/.config/tmux"
    state: directory
    mode: '0755'

- name: Copy tmux configuration
  ansible.builtin.copy:
    src: tmux.conf
    dest: "{{ dotfiles_home }}/.config/tmux/tmux.conf"
    mode: '0644'
  notify: reload tmux

- name: Check if TPM (Tmux Plugin Manager) is installed
  ansible.builtin.stat:
    path: "{{ dotfiles_home }}/.tmux/plugins/tpm"
  register: tpm_check

- name: Install TPM (Tmux Plugin Manager)
  ansible.builtin.git:
    repo: https://github.com/tmux-plugins/tpm
    dest: "{{ dotfiles_home }}/.tmux/plugins/tpm"
    depth: 1
    update: false
  when: not tpm_check.stat.exists

- name: Display TPM installation message
  ansible.builtin.debug:
    msg: "TPM installed. Press prefix + I inside tmux to install plugins"
  when: not tpm_check.stat.exists
